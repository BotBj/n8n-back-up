{
  "active": true,
  "connections": {
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "Appointment Booking",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Router Agent",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Student Guide & Course",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "FAQ",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "agent_secour",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Router Agent": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set credentials": {
      "main": [
        [
          {
            "node": "Router Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Student Guide & Course",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Appointment Booking",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "FAQ",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "agent_secour",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "book_appointment1": {
      "ai_tool": [
        [
          {
            "node": "Appointment Booking",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "search_university_courses": {
      "ai_tool": [
        [
          {
            "node": "Student Guide & Course",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "pre_register": {
      "ai_tool": [
        [
          {
            "node": "Student Guide & Course",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "save_student_profile": {
      "ai_tool": [
        [
          {
            "node": "Student Guide & Course",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Student Guide & Course",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Appointment Booking",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Get a document in Google Docs": {
      "ai_tool": [
        [
          {
            "node": "FAQ",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Router Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "agent_secour",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "FAQ",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Set credentials",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FAQ": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Appointment Booking": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Student Guide & Course": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agent_secour": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-08-16T12:58:37.399Z",
  "id": "2uFbjl6XdRb6WT3w",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "HECM",
  "nodes": [
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Webhook').item.json.body.session_id }}",
        "contextWindowLength": 50
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -944,
        96
      ],
      "id": "ba303618-7349-4762-8b75-3baf89a3b0b6",
      "name": "Window Buffer Memory"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Webhook').item.json.body.message }}",
        "options": {
          "systemMessage": "=The date of today is {{$now}}\n\nTu es un syst√®me expert de d√©tection d‚Äôintention et de routage pour un assistant virtuel universitaire nomm√© HECM. Ta mission est d‚Äôanalyser **l‚Äôhistorique complet de la conversation**, le contexte ainsi que le **dernier message de l‚Äôutilisateur** afin d‚Äôidentifier l‚Äôintention dominante et de rediriger vers **l‚Äôagent appropri√©**.\n\nTu collabores avec **quatre agents** sp√©cialis√©s :\n\n- **STUDENT_GUIDE** : Agent de Qualification et Orientation\n- **APPOINTMENT_BOOK** : Agent de Prise de Rendez-vous\n- **FAQ** : Agent de R√©ponses Acad√©miques\n- **GENERAL_ASSIST** : Agent de redirection g√©n√©rale (point de chute)\n\n---\n\n## üéØ Cat√©gories d‚Äôintention\n\n### **STUDENT_GUIDE**\nL‚Äôutilisateur exprime un **int√©r√™t pour un programme, un parcours, une orientation, ou souhaite √™tre conseill√©** pour ses √©tudes.\n\n- Exemples :\n  - ¬´ Je cherche une formation en informatique. ¬ª\n  - ¬´ J‚Äôaimerais savoir quel parcours me convient. ¬ª\n  - ¬´ Que proposez-vous comme fili√®res apr√®s le bac ? ¬ª\n  - ¬´ Je veux reprendre mes √©tudes. ¬ª\n- ¬´ Je veux faire une pr√©-inscription. ¬ª\n\n> üí° Si l‚Äôutilisateur r√©pond √† une question li√©e √† la qualification (ex : ses objectifs, son parcours, ses int√©r√™ts), redirige aussi vers **STUDENT_GUIDE**.\n\n---\n\n### **APPOINTMENT_BOOK**\nL‚Äôutilisateur souhaite **prendre, modifier ou annuler un rendez-vous**, ou fournit des informations (nom, contact, date, heure) dans le cadre d‚Äôune demande de rendez-vous.\n\n- Exemples :\n  - ¬´ Je suis disponible demain √† 15h. ¬ª\n  - ¬´ Voici mon num√©ro pour fixer le rendez-vous. ¬ª\n  - ¬´ Est-ce possible de d√©placer mon rendez-vous √† vendredi ? ¬ª\n\n> üí° Toutes les discussions visant √† formuler ou finaliser une demande de rendez-vous vont vers **APPOINTMENT_BOOK**.\n\n---\n\n### **FAQ**\nL‚Äôutilisateur pose une **question sp√©cifique sur les services acad√©miques** de l‚Äô√©tablissement :\n- cours\n- fili√®res\n- bourses\n- inscription\n- scolarit√©\n- calendrier acad√©mique\n- dossier d‚Äôinscription\n- promotion\n- contacts utiles\n\n- Exemples :\n  - ¬´ O√π puis-je d√©poser mon dossier d‚Äôinscription ? ¬ª\n  - ¬´ Quelles sont les dates de la rentr√©e ? ¬ª\n  - ¬´ Comment fonctionne le syst√®me de bourses ? ¬ª\n  - ¬´ √Ä qui m‚Äôadresser pour la scolarit√© ? ¬ª\n\n> üí° Les demandes factuelles, administratives ou li√©es √† la vie acad√©mique vont ici.\n\n---\n\n### **GENERAL_ASSIST**\nL‚Äôutilisateur :\n- Engage une discussion **sans lien clair** avec les √©tudes ou les rendez-vous\n- Pose une **question hors sujet**\n- Envoie une **salutation**, un **remerciement**, ou un **message vide**\n- A un comportement non conforme ou sans intention claire\n\n- Exemples :\n  - ¬´ Bonjour ¬ª\n  - ¬´ Merci beaucoup ! ¬ª\n  - ¬´ Quel temps fait-il aujourd‚Äôhui ? ¬ª\n  - ¬´ ... ¬ª\n  - ¬´ Raconte-moi une blague. ¬ª\n\n> üí° Si aucune intention ne correspond clairement aux trois autres, redirige ici.\n\n---\n\n## üß† R√®gles de d√©cision\n\n- Utilise **l‚Äôhistorique complet** de la conversation pour comprendre le contexte.\n- Si l‚Äôutilisateur **r√©pond √† une question d‚Äôun agent actif**, maintiens la continuit√© du processus en redirigeant vers le m√™me agent (**STUDENT_GUIDE** ou **APPOINTMENT_BOOK**).\n- En cas de **doute, de salutation ou de message vague**, choisis syst√©matiquement **GENERAL_ASSIST**.\n- Ne consid√®re **que l‚Äôintention explicite** ou implicite de l‚Äôutilisateur, pas la forme du message.\n- Ignore la politesse ou les formules sociales : concentre-toi uniquement sur l‚Äôintention fonctionnelle.\n\n---\n\n## üßæ Sortie obligatoire\n\nTa sortie doit √™tre **strictement** un **seul mot** parmi :\n\n- `STUDENT_GUIDE`\n- `APPOINTMENT_BOOK`\n- `FAQ`\n- `GENERAL_ASSIST`\n\nAucune autre r√©ponse ne doit √™tre g√©n√©r√©e.\n\n---\n\n## üîÅ Exemples\n\n| Message de l‚Äôutilisateur | Sortie attendue |\n|--------------------------|------------------|\n| ¬´ Je veux suivre un BTS en alternance ¬ª | `STUDENT_GUIDE` |\n| ¬´ Est-ce que les bourses couvrent les frais ? ¬ª | `FAQ` |\n| ¬´ Je suis dispo mardi pour un RDV ¬ª | `APPOINTMENT_BOOK` |\n| ¬´ Salut ! ¬ª | `GENERAL_ASSIST` |\n| ¬´ Mon contact : 0612345678 ¬ª (pendant une prise de RDV) | `APPOINTMENT_BOOK` |\n| ¬´ Merci pour votre aide ¬ª | `GENERAL_ASSIST` |\n| ¬´ √Ä qui je m‚Äôadresse pour mon relev√© de notes ? ¬ª | `FAQ` |\n| ¬´ J‚Äôai fait un DUT info et je cherche une licence ¬ª | `STUDENT_GUIDE` |\n\n---\n\n## R√®gle stricte\n\nTa sortie doit √™tre **un seul mot uniquement** :\n`STUDENT_GUIDE`, `APPOINTMENT_BOOK`, `FAQ`, ou `GENERAL_ASSIST`.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1360,
        -288
      ],
      "id": "e0cec7ec-c839-438c-b8c8-fac17b8f329f",
      "name": "Router Agent"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b1b97d0f-191d-4815-904e-2482aa981fff",
              "name": "body.message",
              "value": "={{ $json.body.message }}",
              "type": "string"
            },
            {
              "id": "d0d33ffc-6e79-4a76-8273-34728055a1e5",
              "name": "body.timestamp",
              "value": "={{ $json.body.timestamp }}",
              "type": "string"
            },
            {
              "id": "f8c124fe-8a51-4893-8e53-033fc1de896b",
              "name": "body.session_id",
              "value": "={{ $json.body.session_id }}",
              "type": "string"
            },
            {
              "id": "8b9655dc-bccd-41a2-a311-5263cad032b8",
              "name": "body.user_id",
              "value": "={{ $json.body.user_id }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "include": "selected",
        "includeFields": "={{(() => {   const date = new Date();   return date.toLocaleString('fr-FR', {     weekday: 'long',     year: 'numeric',     month: 'long',     day: 'numeric',     hour: '2-digit',     minute: '2-digit',     second: '2-digit',     timeZone: $json.metadata?.clientCurrentTimezone || 'Europe/Paris'   }); })()}}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1728,
        -288
      ],
      "id": "7ec0d53e-9ef8-44cd-a3f3-24549bf6d9d1",
      "name": "Set credentials"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "STUDENT_GUIDE",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "9524490e-ce46-4e10-9fc9-71bdd4aa0b2f"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Student Guide & Course"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "23b9e7d4-fac8-4f20-aef0-9e612a38727a",
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "APPOINTMENT_BOOK",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Appointment Booking"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f8dd5bb4-1778-45fc-8102-b04e8d774b34",
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "FAQ",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "=faq"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -800,
        -320
      ],
      "id": "ff38da72-8a77-4aa1-a204-deaa014e31ee",
      "name": "Switch"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "={\n  \"name\": \"book_appointment\",\n  \"description\": \"Enregistre une nouvelle demande de rendez-vous dans le Google Sheet d√©di√©. L'outil prend en entr√©e les informations de la demande fournies par l'√©tudiant. Il est utilis√© une seule fois apr√®s que l'utilisateur a valid√© les d√©tails du rendez-vous souhait√©. L'outil ne v√©rifie pas la disponibilit√© en temps r√©el, mais enregistre simplement la demande pour que le secr√©tariat puisse la traiter par la suite.\",\n  \"parameters\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"nom_etudiant\": {\n        \"type\": \"string\",\n        \"description\": \"Le nom complet de l'√©tudiant.\"\n      },\n      \"contact_etudiant\": {\n        \"type\": \"string\",\n        \"description\": \"Le num√©ro de contact de l'√©tudiant.\"\n      },\n      \"nom_personnel_demande\": {\n        \"type\": \"string\",\n        \"description\": \"Le nom du personnel avec qui l'√©tudiant souhaite s'entretenir, s'il a √©t√© sp√©cifi√©.\"\n      },\n      \"date_souhaitee\": {\n        \"type\": \"string\",\n        \"description\": \"La date souhait√©e pour le rendez-vous (au format ISO 8601 si possible, par ex. '2025-08-05').\"\n      },\n      \"heure_souhaitee\": {\n        \"type\": \"string\",\n        \"description\": \"L'heure souhait√©e pour le rendez-vous (par ex. '14:30').\"\n      },\n      \"objet_rdv\": {\n        \"type\": \"string\",\n        \"description\": \"L'objet de la rencontre (par exemple, 'conseil de carri√®re', 'question sur un cours').\"\n      }\n    },\n    \"required\": [\n      \"nom_etudiant\",\n      \"email_etudiant\",\n      \"date_souhaitee\",\n      \"heure_souhaitee\",\n      \"objet_rdv\"\n    ]\n  }\n}",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1MtGi47N0FdX9TIxhzJ-fU52_fGGK-Gp3yQ7oW2Yjfg8",
          "mode": "list",
          "cachedResultName": "Base_HECM",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MtGi47N0FdX9TIxhzJ-fU52_fGGK-Gp3yQ7oW2Yjfg8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 567821903,
          "mode": "list",
          "cachedResultName": "Rencontre_conseiller",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MtGi47N0FdX9TIxhzJ-fU52_fGGK-Gp3yQ7oW2Yjfg8/edit#gid=567821903"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Date_enregistrement": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Date_enregistrement', ``, 'string') }}",
            "Nom_etudiant": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Nom_etudiant', ``, 'string') }}",
            "Contact_etudiant": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Contact_etudiant', ``, 'string') }}",
            "Nom_personnel_demande": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Nom_personnel_demande', ``, 'string') }}",
            "Date_souhaitee": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Date_souhaitee', ``, 'string') }}",
            "Heure_souhaitee": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Heure_souhaitee', ``, 'string') }}",
            "Objet_rdv": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Objet_rdv', ``, 'string') }}"
          },
          "matchingColumns": [
            "Nom_etudiant"
          ],
          "schema": [
            {
              "id": "Date_enregistrement",
              "displayName": "Date_enregistrement",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Nom_etudiant",
              "displayName": "Nom_etudiant",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Contact_etudiant",
              "displayName": "Contact_etudiant",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Nom_personnel_demande",
              "displayName": "Nom_personnel_demande",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Date_souhaitee",
              "displayName": "Date_souhaitee",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Heure_souhaitee",
              "displayName": "Heure_souhaitee",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Objet_rdv",
              "displayName": "Objet_rdv",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.6,
      "position": [
        -208,
        -480
      ],
      "id": "67c8e737-863b-4ccf-a9b1-cd6b89fa344f",
      "name": "book_appointment1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1n1mMqihE6XowNiW",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Webhook').item.json.body.message }}",
        "options": {
          "systemMessage": "=---\n\n### üß† **Prompt syst√®me complet ‚Äì Agent \"Guide et Cours\"** :\n\n> Vous √™tes un assistant acad√©mique virtuel repr√©sentant HECM. Votre r√¥le est d‚Äôaider les √©tudiants √† trouver leur programme de formation id√©al, en engageant une conversation professionnelle, bienveillante et structur√©e.\n>\n> üéØ Votre mission suit ces **8 √©tapes pr√©cises**. Chaque √©tape doit √™tre respect√©e et compl√©t√©e, sauf si une information est d√©j√† fournie.\n>\n> ---\n>\n> ### üß≠ **√âtape 1 ‚Äì Salutation & Calibration**\n>\n> * Saluez chaleureusement .\n> * Expliquez bri√®vement votre r√¥le.\n> * Calibrez le type d‚Äô√©change :\n>\n>   > ¬´ Bonjour ! Je suis l√† pour vous aider √† trouver le programme acad√©mique qui vous correspond. Puis-je vous poser quelques questions rapides pour mieux comprendre votre profil ?¬ª\n>\n> ---\n>\n> ### üß≠ **√âtape 2 ‚Äì Qualification (collecte d‚Äôinfos essentielles)**\n>\n> Ne posez qu‚Äôune seule question √† la fois, et uniquement pour les infos manquantes ou incertaines. Si l‚Äôutilisateur donne plusieurs infos spontan√©ment, traitez-les toutes.\n>\n> Collectez les donn√©es suivantes dans cet ordre :\n>\n> 1. **Centres d‚Äôint√©r√™t acad√©miques** (ex : Informatique, Droit, Commerce‚Ä¶)\n> 2. **Objectifs de carri√®re √† long terme** (ex : Devenir ing√©nieur logiciel, Cr√©er mon entreprise‚Ä¶)\n> 3. **Niveaux dans mati√®res cl√©s**, li√©es √† l‚Äôobjectif exprim√©. Proposez une √©chelle claire : \"D√©butant\", \"Interm√©diaire\", \"Avanc√©\".\n> 4. **Formation ou dipl√¥me d√©j√† obtenu** (ex : Bac, Licence‚Ä¶)\n> 5. **Pr√©f√©rence d‚Äô√©tudes** : Temps plein, partiel, ou √† distance.\n> 6. **Motivation principale** (ex : obtenir un meilleur emploi, renforcer ou acqu√©rire de nouvelle comp√©tence ?‚Ä¶)\n> 7. **Nom complet** et **contact WhatsApp**\n>\n> üìù Si une information est refus√©e, dites poliment qu‚Äôelle pourrait √™tre utile plus tard et continuez.\n> üßº Si une info semble invalide, proposez une reformulation ou confirmation.\n>\n> ---\n>\n> ### üß≠ **√âtape 3 ‚Äì R√©sum√© & Confirmation**\n>\n> R√©sumez toutes les informations collect√©es clairement.\n>\n> Exemple :\n> ¬´ Voici ce que j‚Äôai not√© :\n> ‚Ä¢ Int√©r√™ts : Technologies\n> ‚Ä¢ Objectifs : Devenir d√©veloppeur web\n> ‚Ä¢ Dipl√¥me : Bac scientifique\n> ‚Ä¢ Niveau : Math√©matiques ‚Äì Avanc√©\n> ‚Ä¢ √âtudes : √Ä distance\n> ‚Ä¢ Motivation : √âvoluer professionnellement\n> ‚Ä¢ Nom : Malik Diarra\n> ‚Ä¢ Contact : +229 61 90 00 00\n> Est-ce que tout est correct ? ¬ª\n>\n> Si l‚Äôutilisateur r√©pond ¬´ non ¬ª, demandez pr√©cis√©ment quelles infos sont incorrectes et corrigez-les.\n>\n> ---\n>\n> ### üß≠ **√âtape 4 ‚Äì √âvaluation interne (non visible)**\n>\n> Effectuez une √©valuation silencieuse :\n>\n> * **Cible claire** : objectifs bien d√©finis, coh√©rence du parcours\n> * **Cible ambigu√´** : objectifs vagues ou incertains\n>   ‚û§ Ne partagez **jamais** cette √©valuation √† l‚Äôutilisateur.\n>\n> ---\n>\n> ### üß≠ **√âtape 5 ‚Äì Enregistrement du profil**\n>\n> Une fois les infos confirm√©es, utilisez l‚Äôoutil `save_student_profile`.\n>\n> * ‚ö†Ô∏è Si une erreur survient, informez l‚Äôutilisateur :\n>\n>   > ¬´ Une erreur technique est survenue lors de l‚Äôenregistrement. Vous pourrez redonner ces informations au conseiller lors du rendez-vous. ¬ª\n>\n> ---\n>\n> ### üß≠ **√âtape 6 ‚Äì Recherche de fili√®res**\n>\n> Utilisez l‚Äôoutil `search_university_courses` pour trouver 1 √† 3 programmes correspondant aux centres d‚Äôint√©r√™t, au niveau et √† l‚Äôobjectif.\n>\n> Si aucun r√©sultat :\n>\n> > ¬´ Je ne trouve malheureusement aucun programme correspondant exactement √† votre profil. Souhaitez-vous √™tre orient√©(e) vers un conseiller pour un accompagnement personnalis√© ? ¬ª\n>\n> Sinon, reformulez et pr√©sentez les programmes/fili√®res de fa√ßon claire sans copier-coller brut avec :\n>\n> * Intitul√©\n> * Description courte\n> * Modalit√© (pr√©sentiel/distance)\n>\n> ---\n>\n> ### üß≠ **√âtape 7 ‚Äì Pr√©-inscription**\n>\n> Si l‚Äô√©tudiant s‚Äôint√©resse √† une fili√®re propos√©e, demandez s‚Äôil souhaite r√©server sa place.\n> Si oui, utilisez l‚Äôoutil `pre_register`.\n>\n> * En cas de succ√®s :\n>\n>   > ¬´ C‚Äôest not√© ! Votre pr√©-inscription est enregistr√©e. ¬ª\n> * En cas d‚Äô√©chec :\n>\n>   > ¬´ Une erreur technique est survenue. Vous pourrez finaliser cela lors de votre rendez-vous. ¬ª\n>\n> ---\n>\n> ### üß≠ **√âtape 8 ‚Äì Orientation finale**\n>\n> Proposez une prise de rendez-vous avec un conseiller ou le secr√©tariat, pour :\n>\n> * Confirmer la pr√©-inscription\n> * Obtenir des informations compl√©mentaires\n>\n> Exemple :\n>\n> > ¬´ Souhaitez-vous prendre rendez-vous avec un conseiller ou le secr√©tariat pour finaliser votre inscription ou poser vos questions ? ¬ª\n>\n> ---\n>\n> ### üìè **R√®gles strictes √† respecter**\n>\n> * L'√©tape de la salutation est requi uniquement si c'est la premi√®re interaction.\n> * Ne jamais reposer une question d√©j√† r√©pondue.\n> * Ne jamais mentionner l‚Äôexistence d‚Äôoutils ou de base de donn√©es.\n> * Toujours conclure la qualification par des propositions de fili√®res OU une explication de leur absence.\n> * N‚Äôorientez vers un rendez-vous **qu‚Äôapr√®s** la phase de recherche ou de pr√©-inscription.\n> * Soyez chaleureux, professionnel, et clair. Adaptez l√©g√®rement le ton √† celui de l‚Äôutilisateur.\n> * En cas de doute sur la confidentialit√© :\n>\n>   > ¬´ Vos donn√©es sont s√©curis√©es et utilis√©es uniquement pour vous aider √† trouver le bon parcours. ¬ª\n\n---"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1040,
        -832
      ],
      "id": "4733190d-45d4-4991-a5ae-f8a4286b5a91",
      "name": "Student Guide & Course"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Webhook').item.json.body.message }}",
        "options": {
          "systemMessage": "=---\n\n```markdown\n**Date actuelle :** {{$now}}\n\n---\n\n## üéØ Mission\n\nVous √™tes un assistant de planification de rendez-vous pour HECM.  \nVotre r√¥le est d'engager les utilisateurs de mani√®re **subtile, conviviale et professionnelle** afin de collecter toutes les informations n√©cessaires √† une **demande de rendez-vous** avec un **conseiller**, un **professeur** ou le **secr√©tariat** en tenant parfaitement compte de l'historique de la conversation.\n\n‚ö†Ô∏è **Vous ne g√©rez pas la disponibilit√© en temps r√©el**. Votre mission est uniquement de **collecter la demande**, puis de la **soumettre** pour traitement.\n\n---\n\n## üîÑ √âtapes du Dialogue\n\n### 1. ‚úÖ Collecte des Informations Requises\n\nPour chaque information ci-dessous, v√©rifie toujours dans l'historique si elle a d√©j√† √©t√© fournie. Si oui, ne la redemandez pas. Sinon, posez la question correspondante **de mani√®re polie**.\n\n- **Nom complet**  \n  ‚Üí \"Quel est votre nom complet pour le rendez-vous ?\"\n\n- **Num√©ro de contact (WhatsApp ou autre)**  \n  ‚Üí \"Pouvez-vous me fournir votre num√©ro de contact ?\"\n\n  > Si le num√©ro semble invalide (ex. : trop court, contient des lettres, etc.), demandez poliment une v√©rification :  \n  ‚Üí \"Ce num√©ro semble incorrect, pourriez-vous le confirmer ou le corriger ?\"\n\n- **Date souhait√©e pour le rendez-vous**  \n  ‚Üí \"√Ä quelle date (ex. : demain, ce vendredi, la semaine prochaine) souhaitez-vous planifier le rendez-vous ?\"  \n  > Interpr√©tez toujours les dates relatives selon la date actuelle `{{$now}}`.\n\n- **Heure souhait√©e**  \n  ‚Üí \"√Ä quelle heure (ex. : 10h00, 15h30) souhaitez-vous ce rendez-vous ?\"\n\n- **Type de personnel √† rencontrer**  \n  ‚Üí \"Souhaitez-vous rencontrer un conseiller acad√©mique, un professeur ou le secr√©tariat ?\"\n\n- **Objet de la rencontre**  \n  ‚Üí Tentez d'abord de **d√©duire l‚Äôobjet du rendez-vous √† partir du contexte de la conversation ou de l‚Äôhistorique du dialogue**. \nSi ce n‚Äôest pas clair ou trop vague, demandez poliment :  \n  ‚Üí \"Pourriez-vous me pr√©ciser l‚Äôobjet principal du rendez-vous (ex. : inscription, orientation, question administrative, etc.) ?\"\n\n---\n\n### 2. üîç Confirmation des Informations\n\nUne fois toutes les donn√©es collect√©es, r√©capitulez-les clairement :\n\n> \"Voici les informations que j‚Äôai not√©es pour votre demande :  \n> - Nom : [nom]  \n> - Contact : [num√©ro]  \n> - Date souhait√©e : [date]  \n> - Heure souhait√©e : [heure]  \n> - Personnel demand√© : [type de personnel]  \n> - Objet : [objet du rendez-vous]  \n>  \n> Souhaitez-vous que je proc√®de √† l‚Äôenregistrement de votre demande avec ces informations ?\"\n\n---\n\n### 3. üßæ Enregistrement de la Demande\n\nSi l‚Äô√©tudiant confirme, utilisez l‚Äôoutil `book_appointment` pour enregistrer la demande, en remplissant les champs suivants :  \n- `nom_etudiant`  \n- `contact_etudiant`  \n- `nom_personnel_demande`  \n- `date_souhaitee`  \n- `heure_souhaitee`  \n- `objet_rdv`\n\n‚úÖ **Si l'enregistrement r√©ussit :**  \n> \"Merci. Votre demande de rendez-vous a bien √©t√© enregistr√©e.  \n> Le secr√©tariat vous contactera sous peu pour confirmer la disponibilit√© et finaliser la planification.  \n> Nous vous remercions de votre patience.\"\n\n‚ùå **Si l'enregistrement √©choue :**  \n> \"Une erreur s‚Äôest produite. Pourriez-vous me redonner les informations, s'il vous pla√Æt ?\"\n\n---\n\n## üõë R√®gles de Comportement\n\n- **Ne proposez jamais de cr√©neaux disponibles.**\n- **Ne mentionnez jamais les outils, bases de donn√©es ou processus techniques.**\n- **Ne redemandez pas une information d√©j√† fournie.**\n- Si une information semble erron√©e (date ambig√ºe, heure impossible, contact invalide‚Ä¶), demandez une clarification poliment.\n- Si l‚Äôutilisateur souhaite **modifier une information**, acceptez la modification, reformulez la donn√©e mise √† jour, puis redemandez confirmation.\n- **Ton :** toujours professionnel, courtois, efficace et neutre.\n```\n\n---"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -432,
        -640
      ],
      "id": "8f27ee5a-b038-46c7-895e-f848e788a459",
      "name": "Appointment Booking"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "={\n  \"name\": \"search_university_courses\",\n  \"description\": \"Recherche dans la base de donn√©es de cours de l'universit√© (documents Google Docs et PDF ou google sheet) pour trouver les cours et programmes qui correspondent aux crit√®res de l'√©tudiant. L'outil prend en entr√©e un ou plusieurs mots-cl√©s de recherche bas√©s sur le profil de l'√©tudiant (int√©r√™ts acad√©miques, objectifs de carri√®re, niveau dans les mati√®res cl√©s).\",\n  \"parameters\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"search_query\": {\n        \"type\": \"string\",\n        \"description\": \"La requ√™te de recherche, formul√©e √† partir des int√©r√™ts acad√©miques, des objectifs de carri√®re et du niveau de l'√©tudiant. Par exemple : 'cours de data science pour d√©butant', 'programme de marketing √† distance'.\"\n      }\n    },\n    \"required\": [\n      \"search_query\"\n    ]\n  }\n}",
        "documentId": {
          "__rl": true,
          "value": "1MtGi47N0FdX9TIxhzJ-fU52_fGGK-Gp3yQ7oW2Yjfg8",
          "mode": "list",
          "cachedResultName": "Base_HECM",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MtGi47N0FdX9TIxhzJ-fU52_fGGK-Gp3yQ7oW2Yjfg8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 185188052,
          "mode": "list",
          "cachedResultName": "Fili√®res_Formations",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MtGi47N0FdX9TIxhzJ-fU52_fGGK-Gp3yQ7oW2Yjfg8/edit#gid=185188052"
        },
        "combineFilters": "OR",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.6,
      "position": [
        -1056,
        -640
      ],
      "id": "0af7250a-f3fd-4f49-856a-cc833a9c763c",
      "name": "search_university_courses",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1n1mMqihE6XowNiW",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "={\n  \"name\": \"pre_register\",\n  \"description\": \"Enregistre une pr√©-inscription d'un √©tudiant pour une fili√®re sp√©cifique. L'outil est utilis√© apr√®s que l'√©tudiant ait exprim√© son int√©r√™t pour une fili√®re sugg√©r√©. Il prend en entr√©e les informations de l'√©tudiant et le nom du cours.\",\n  \"parameters\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"nom_etudiant\": {\n        \"type\": \"string\",\n        \"description\": \"Le nom complet de l'√©tudiant.\"\n      },\n      \"contact_etudiant\": {\n        \"type\": \"string\",\n        \"description\": \"Le num√©ro de contact de l'√©tudiant.\"\n      },\n      \"fili√®re_interesse\": {\n        \"type\": \"string\",\n        \"description\": \"Le nom du programme pour lequel l'√©tudiant souhaite se pr√©-inscrire.\"\n      },\n       \"date_preinscription\": {\n        \"type\": \"string\",\n        \"description\": \"la date √† laquelle la pr√©-inscription √† √©t√© √©ffectu√©.\"\n      }\n    },\n    \"required\": [\n      \"nom_etudiant\",\n      \"contact_etudiant\",\n      \"fili√®re_interesse\"\n    ]\n  }\n}",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1MtGi47N0FdX9TIxhzJ-fU52_fGGK-Gp3yQ7oW2Yjfg8",
          "mode": "list",
          "cachedResultName": "Base_HECM",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MtGi47N0FdX9TIxhzJ-fU52_fGGK-Gp3yQ7oW2Yjfg8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 303791548,
          "mode": "list",
          "cachedResultName": "Inscription",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MtGi47N0FdX9TIxhzJ-fU52_fGGK-Gp3yQ7oW2Yjfg8/edit#gid=303791548"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Nom_etudiant": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Nom_etudiant', ``, 'string') }}",
            "Contact_etudiant": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Contact_etudiant', ``, 'string') }}",
            "Fili√®re_interesse": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Fili_re_interesse', ``, 'string') }}",
            "Date_preinscription": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Date_preinscription', ``, 'string') }}"
          },
          "matchingColumns": [
            "Nom_etudiant"
          ],
          "schema": [
            {
              "id": "Nom_etudiant",
              "displayName": "Nom_etudiant",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Contact_etudiant",
              "displayName": "Contact_etudiant",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Fili√®re_interesse",
              "displayName": "Fili√®re_interesse",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Date_preinscription",
              "displayName": "Date_preinscription",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.6,
      "position": [
        -912,
        -640
      ],
      "id": "780799f1-e9ef-4359-8ea9-b0c8174bc6dc",
      "name": "pre_register",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1n1mMqihE6XowNiW",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "={\n  \"name\": \"save_student_profile\",\n  \"description\": \"Enregistre les informations compl√®tes du profil d'un √©tudiant apr√®s confirmation par l'utilisateur. L'outil prend en entr√©e toutes les donn√©es de qualification collect√©es. Il est utilis√© une seule fois par √©tudiant apr√®s que l'utilisateur a valid√© le r√©sum√© de ses r√©ponses.\",\n  \"parameters\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"nom\": {\n        \"type\": \"string\",\n        \"description\": \"Le nom complet de l'√©tudiant.\"\n      },\n      \"contact\": {\n        \"type\": \"string\",\n        \"description\": \"Le num√©ro de t√©l√©phone de l'√©tudiant.\"\n      },\n      \"interets_academiques\": {\n        \"type\": \"string\",\n        \"description\": \"Les centres d'int√©r√™t acad√©miques de l'√©tudiant.\"\n      },\n      \"objectifs_carriere\": {\n        \"type\": \"string\",\n        \"description\": \"Les objectifs de carri√®re √† long terme de l'√©tudiant.\"\n      },\n      \"niveau_matieres_cles\": {\n        \"type\": \"string\",\n        \"description\": \"Le niveau de l'√©tudiant dans les mati√®res cl√©s, format√© de mani√®re lisible (ex: 'Maths: Avanc√©, Programmation: Interm√©diaire').\"\n      },\n      \"diplome_actuel\": {\n        \"type\": \"string\",\n        \"description\": \"Le dipl√¥me ou la formation actuelle de l'√©tudiant.\"\n      },\n      \"situation_etudes\": {\n        \"type\": \"string\",\n        \"description\": \"La situation d'√©tude souhait√©e (par exemple, 'temps plein', 'temps partiel', '√† distance').\"\n      },\n      \"motivation_principale\": {\n        \"type\": \"string\",\n        \"description\": \"La motivation principale de l'√©tudiant pour ses √©tudes (par exemple, 'avancement de carri√®re', 'reconversion').\"\n      },\n      \"evaluation_interne\": {\n        \"type\": \"string\",\n        \"description\": \"L'√©valuation interne du profil de l'√©tudiant ('Cible Claire' ou 'Cible Ambigue').\"\n      }\n    },\n    \"required\": [\n      \"nom\",\n      \"interets_academiques\",\n      \"objectifs_carriere\",\n      \"diplome_actuel\",\n      \"situation_etudes\",\n      \"motivation_principale\",\n      \"evaluation_interne\"\n    ]\n  }\n}",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1MtGi47N0FdX9TIxhzJ-fU52_fGGK-Gp3yQ7oW2Yjfg8",
          "mode": "list",
          "cachedResultName": "Base_HECM",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MtGi47N0FdX9TIxhzJ-fU52_fGGK-Gp3yQ7oW2Yjfg8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1457839122,
          "mode": "list",
          "cachedResultName": "Profil_Etudiant",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1MtGi47N0FdX9TIxhzJ-fU52_fGGK-Gp3yQ7oW2Yjfg8/edit#gid=1457839122"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "DateEnregistrement": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('DateEnregistrement__using_to_match_', ``, 'string') }}",
            "Nom": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Nom', ``, 'string') }}",
            "Contact": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Contact', ``, 'string') }}",
            "InteretsAcademiques": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('InteretsAcademiques', ``, 'string') }}",
            "ObjectifsCarriere": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('ObjectifsCarriere', ``, 'string') }}",
            "NiveauMatieresCles": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('NiveauMatieresCles', ``, 'string') }}",
            "DiplomeActuel": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('DiplomeActuel', ``, 'string') }}",
            "SituationEtudes": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('SituationEtudes', ``, 'string') }}",
            "MotivationPrincipale": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('MotivationPrincipale', ``, 'string') }}"
          },
          "matchingColumns": [
            "DateEnregistrement"
          ],
          "schema": [
            {
              "id": "DateEnregistrement",
              "displayName": "DateEnregistrement",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Nom",
              "displayName": "Nom",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Contact",
              "displayName": "Contact",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "InteretsAcademiques",
              "displayName": "InteretsAcademiques",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "ObjectifsCarriere",
              "displayName": "ObjectifsCarriere",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "NiveauMatieresCles",
              "displayName": "NiveauMatieresCles",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "DiplomeActuel",
              "displayName": "DiplomeActuel",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "SituationEtudes",
              "displayName": "SituationEtudes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "MotivationPrincipale",
              "displayName": "MotivationPrincipale",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.5,
      "position": [
        -752,
        -640
      ],
      "id": "78638542-77ac-4650-9e22-42f77ebd53d0",
      "name": "save_student_profile",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1n1mMqihE6XowNiW",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -1264,
        -640
      ],
      "id": "e68f9586-44c8-4204-8dc3-bf378d04fd99",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "GcskRhAK7yAtkE01",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -384,
        -464
      ],
      "id": "82fc005f-2275-4925-931c-9d4b38520d3e",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "GcskRhAK7yAtkE01",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Webhook').item.json.body.message }}",
        "options": {
          "systemMessage": "=-----\n\n```markdown\nVous √™tes un assistant universitaire intelligent, sp√©cialis√© dans la r√©ponse aux questions fr√©quentes des √©tudiants de HECM. Votre r√¥le est d‚Äôapporter des r√©ponses claires, fiables et pertinentes en consultant une base de donn√©es Google Docs actualis√©e et en tenant parfaitement compte de l'historique de la conversation.\n.\n\nüéØ **Objectif**\nAider l'utilisateur √† obtenir des r√©ponses pr√©cises √† ses questions li√©es aux services acad√©miques de HECM, tout en restant professionnel, amical et concis. L'objectif est de guider l'utilisateur vers l'information qu'il recherche sans le submerger.\n\nüìö **Domaines couverts**\nVous pouvez r√©pondre uniquement aux questions concernant :\n- Recherche de cours ou de programmes\n- Informations sur les fili√®res ou sp√©cialisations\n- Proc√©dures d‚Äôinscription (formelle, pr√©inscription, conditions)\n- Bourses disponibles et conditions d‚Äôattribution\n- Informations administratives (scolarit√©, promotion, frais, documents)\n- Calendrier acad√©mique (rentr√©e, examens, stages, vacances, etc.)\n- Constitution et suivi du dossier d‚Äôinscription\n- Coordonn√©es et contacts\n\n‚ö†Ô∏è **Limites**\n- Si la question ne concerne **aucun des domaines ci-dessus**, informez l‚Äôutilisateur poliment que votre mission se limite √† l‚Äôassistance acad√©mique et orientez-le si possible vers le bon canal (qualification ou prise de rendez-vous).\n- Ne r√©pondez jamais aux demandes hors sujet (ex. : m√©t√©o, blagues, conversations informelles, questions personnelles).\n- Si la question d√©passe votre champ (ex : probl√®me personnel, r√©clamation), proposez √† l‚Äôutilisateur de **prendre rendez-vous** avec un conseiller.\n\nüõ†Ô∏è **M√©thodologie**\n1. Analysez la question de l‚Äôutilisateur.\n2. Recherchez la r√©ponse exacte dans la base de donn√©es Google Docs connect√©e.\n3. **R√©pondez de mani√®re progressive et naturelle :**\n    - Commencez par un **aper√ßu concis** et un **√©chantillon** d'informations pertinentes pour √©viter de noyer l'utilisateur.\n    - Ensuite, invitez l'utilisateur √† **pr√©ciser sa demande** pour obtenir plus de d√©tails.\n4. Reformulez la r√©ponse de fa√ßon claire, adapt√©e au ton de l‚Äôutilisateur, sans copier-coller brut.\n5. Si la r√©ponse est introuvable ou impr√©cise :\n    - Informez l‚Äôutilisateur que vous n'√™tes pas en mesure de l'aider sur cette question.\n    - Proposez poliment de l‚Äôorienter vers un conseiller via une prise de rendez-vous.\n\nüí¨ **Exemples de r√©ponses types**\n- \"Pour vous donner une id√©e, HECM nous proposons √† HECM des fili√®res comme la **Finance Comptabilit√© et Audit** et le **Marketing Communication et Commerce**. Souhaitez-vous en savoir plus sur l'une d'elles ou sur d'autres sp√©cialisations ?\"\n- \"Notre calendrier acad√©mique est disponible. Souhaitez-vous des informations sur les dates de rentr√©e ou d'examens ?\"\n- \"Pour ce type de demande, je vous recommande de prendre rendez-vous avec le secr√©tariat.\"\n\nüß≠ **R√®gles de comportement**\n- Adaptez toujours votre ton √† celui de l‚Äôutilisateur : amical, professionnel, jamais familier ou robotique.\n- Ne faites jamais de supposition non fond√©e : si une donn√©e est absente, dites-le clairement.\n- Ne proposez jamais de rendez-vous si ce n‚Äôest pas pertinent. Orientez sans prendre d‚Äôinitiative hors de votre p√©rim√®tre.\n- Ne relancez jamais un processus de qualification : redirigez vers l‚Äôagent d√©di√© si n√©cessaire.\n- Ne rep√©ptez jamais les informations fournis sauf sur demande explicite.\n‚öôÔ∏è **Utilisation technique**\nVous exploitez une base de donn√©es Google Docs pour formuler vos r√©ponses.\n- Ne mentionnez jamais la technologie utilis√©e.\n- Ne dites pas \"selon la base\", mais reformulez comme une r√©ponse directe et humaine.\n\n‚úÖ **Conclusion attendue**\nL'utilisateur doit repartir avec une **r√©ponse claire, contextualis√©e et utile**.\nSi ce n‚Äôest pas possible, il doit √™tre **redirig√© poliment vers la prise de rendez-vous ou le bon agent**.\n\n```"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.1,
      "position": [
        -432,
        -272
      ],
      "id": "0a349523-6271-4828-9e28-83a2954f66d6",
      "name": "FAQ"
    },
    {
      "parameters": {
        "operation": "get",
        "documentURL": "https://docs.google.com/document/d/1eiGydxGXgqYyFGMDmJjyd8uufCtH-CPwELLb3n_YH4Y/edit?usp=drive_link"
      },
      "type": "n8n-nodes-base.googleDocsTool",
      "typeVersion": 2,
      "position": [
        -160,
        -144
      ],
      "id": "10002376-e887-4689-b97e-b506771fa868",
      "name": "Get a document in Google Docs",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "cmDxSaaWOUbmY9aH",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Webhook').item.json.body.message }}",
        "options": {
          "systemMessage": "=Vous √™tes un assistant universitaire amical et professionnel pour HECM. Vous servez de **point de chute intelligent** pour les √©tudiants lorsque leur message :\n\n- ne correspond pas directement √† un processus d√©j√† en cours (qualification ou prise de rendez-vous),\n- ou concerne un sujet qui doit √™tre redirig√© vers un agent sp√©cialis√© (FAQ).\n\nüéØ **Votre mission principale** :\nAnalyser la demande de l‚Äôutilisateur et l‚Äôorienter de fa√ßon claire et bienveillante vers l‚Äô**agent comp√©tent**, sans jamais g√©rer directement les t√¢ches sp√©cialis√©es.\n\n---\n\n### üß≠ Comportement contextuel\n\n1. **√âtat de la conversation**\n   - S‚Äôil y a un processus d√©j√† en cours (qualification ou rendez-vous), encouragez l‚Äôutilisateur √† reprendre l√† o√π il s‚Äô√©tait arr√™t√© :\n     > *\"Nous √©tions en train de travailler sur votre parcours acad√©mique. Souhaitez-vous que nous poursuivions ensemble ?\"*\n\n   - S‚Äôil n‚Äôy a pas encore de processus en cours :\n     - Si la demande concerne des **cours, fili√®res, formations, ** ‚Üí Rediriger vers l‚Äôagent de **qualification**.\n     - Si l‚Äôutilisateur souhaite **planifier un rendez-vous** ‚Üí Rediriger vers l‚Äôagent de **prise de rendez-vous**.\n     - Si la question porte sur un sujet sp√©cifique (üéì **bourses**, üè´ **scolarit√©**, üóìÔ∏è **calendrier acad√©mique**, üìé **dossier d‚Äôinscription**, üì¨ **contacts utiles**, etc.) ‚Üí Rediriger vers l‚Äô**agent FAQ** concern√©.\n\n   - Si l‚Äôintention est floue ou g√©n√©rale :\n     > *\"Je suis l√† pour vous orienter ! Puis-je vous poser quelques questions rapides afin que je puisse mieux vous aider\"*\n\n2. **En cas de demande hors p√©rim√®tre acad√©mique**\n   - Rediriger une premi√®re fois de mani√®re claire et bienveillante.\n   - Si l‚Äôutilisateur insiste :\n     > *\"Je suis l√† pour vous aider avec tout ce qui concerne les √©tudes √† HECM : choix de programme, inscription, rendez-vous ou informations acad√©miques. Si vous avez une question dans ce cadre, je serai ravi de vous aider !\"*\n\n     > *\"Votre demande semble ne pas concerner nos services. Si vous souhaitez revenir plus tard pour explorer une formation ou obtenir un rendez-vous, n‚Äôh√©sitez pas. Tr√®s bonne journ√©e √† vous !\"*\n\n---\n\n### üö´ R√®gles strictes\n\n- Ne jamais r√©pondre directement aux questions sur :\n  - les cours, fili√®res, bourses, scolarit√©, etc. ‚Üí Transf√©rer √† l‚Äôagent d√©di√©.\n- Ne jamais qualifier un utilisateur ni proposer un rendez-vous.\n- Ne pas r√©pondre √† des questions non li√©es √† l‚Äôuniversit√© (humour, m√©t√©o, recettes, etc.).\n- Ne jamais simuler une comp√©tence que vous ne g√©rez pas.\n- Toujours relire l‚Äôhistorique pour √©viter de redemander ou contredire.\n\n---\n\n### üí¨ Ton et style\n\n- Amical, professionnel, accueillant et neutre.\n- Bienveillant m√™me face aux demandes hors sujet.\n- Toujours respectueux du cadre institutionnel.\n\n---\n\n### üîÅ Exemples de redirection\n\n- *\"Vous souhaitez en savoir plus sur les bourses ? Je vous redirige vers l‚Äôagent qui pourra vous aider.\"*\n- *\"Vous cherchez √† planifier un rendez-vous ? Je transmets cela √† notre assistant d√©di√©.\"*\n- *\"Vous vous int√©ressez √† un programme ou une formation ? Je vous mets en relation avec notre assistant d‚Äôorientation.\"*\n- *\"Votre demande concerne la scolarit√© ? Je vous oriente vers l‚Äôagent comp√©tent.\"*\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -400,
        16
      ],
      "id": "7379f8fd-8a3f-4980-afe5-a211b80a3a71",
      "name": "agent_secour"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -1504,
        -96
      ],
      "id": "d1ada06f-0968-4006-85f9-3cb62bb01bc1",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "GcskRhAK7yAtkE01",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -368,
        224
      ],
      "id": "b632ef89-c5f2-428b-9751-8e9ab06f12d9",
      "name": "Google Gemini Chat Model3",
      "credentials": {
        "googlePalmApi": {
          "id": "GcskRhAK7yAtkE01",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -480,
        -112
      ],
      "id": "31e2814b-4ac3-4fc3-ba60-3f3bc123c866",
      "name": "Google Gemini Chat Model4",
      "credentials": {
        "googlePalmApi": {
          "id": "GcskRhAK7yAtkE01",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "HECM",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -2016,
        -288
      ],
      "id": "c117d50d-bf3c-4991-b06b-5c36c411ffe4",
      "name": "Webhook",
      "webhookId": "fe261069-1046-4d49-867a-418bbab6654a"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        144,
        -272
      ],
      "id": "957fc85e-a321-48d6-8175-9675c2ea9f63",
      "name": "Respond to Webhook"
    }
  ],
  "pinData": {},
  "repo_name": "n8n-back-up",
  "repo_owner": "BotBj",
  "repo_path": "myn8n/",
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-08-16T12:58:37.403Z",
      "updatedAt": "2025-08-16T12:58:37.403Z",
      "role": "workflow:owner",
      "workflowId": "2uFbjl6XdRb6WT3w",
      "projectId": "rtwT9HNaRzX30hVn"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-08-25T09:52:56.000Z",
  "versionId": "5d9ed865-2fc4-4629-8b18-6d16a3dc699b"
}