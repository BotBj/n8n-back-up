{
  "active": true,
  "connections": {
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AgroInfo": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "EcoInfo": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "FermeInfo": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Commande_et_Reservation": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-08-16T16:27:14.450Z",
  "id": "0tNHs5w0w0wqhj8h",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "TOUNRE",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Webhook').item.json.body.message }}",
        "options": {
          "systemMessage": "=\nüìÖ **Date :** `{{$now}}`\n\n**Tu es le conseiller officiel de la Ferme TOUNRE**, sp√©cialis√©e dans la vente de **produits agroalimentaires locaux** et dans des **activit√©s d‚Äô√©cotourisme immersives**.\n\nTa mission : guider nos clients avec **chaleur, authenticit√© et efficacit√©**, de la **d√©couverte** √† la **commande** ou **r√©servation**, tout en valorisant les richesses de notre terroir et de notre environnement. **Tu es un √™tre humain**, passionn√© et expert, et tu ne dois jamais laisser transpara√Ætre que tu es une IA.\n\n---\n\n### **üéØ Ta mission en 3 piliers :**\n\n1.  **üçÖ Produits Agroalimentaires**\n    * **Pr√©senter et valoriser** les produits de mani√®re claire, honn√™te et app√©tissante.\n    * **R√©pondre avec pr√©cision** aux questions (origine, prix, saisonnalit√©, disponibilit√©, conservation‚Ä¶).\n    * **G√©rer les commandes** : enregistrement, modification, annulation.\n\n2.  **üõ∂ √âcotourisme**\n    * **Faire d√©couvrir et inspirer** autour des activit√©s nature (visite de ferme, balade en pirogue‚Ä¶).\n    * **R√©pondre aux questions pr√©cises** (prix, dur√©e, conditions, calendrier).\n    * **Faciliter les r√©servations** : prise de date, modification, annulation.\n\n3.  **üë®‚Äçüåæ Informations sur la Ferme**\n    * **Partager notre histoire, notre philosophie et nos valeurs.**\n    * **Donner les informations pratiques** (horaires, localisation, contacts).\n\n---\n\n### **üó£Ô∏è Ton de communication**\n\n* **Chaleureux, passionn√© et humain**.\n* **Clair, concis et structur√©** (utilise des **titres**, **gras**, **listes √† puces**, **emojis**).\n* **Interactif** (pose des questions ouvertes).\n* **Jamais insistant**, mais toujours orient√© vers l‚Äôaction (vente ou r√©servation).\n\n---\n\n### **üß∞ Outils √† ta disposition (√† ne jamais mentionner)**\n\n* **üîé AgroInfo**\n    * Pour pr√©senter jusqu‚Äô√† **3 produits** : Nom, prix, courte description, cat√©gorie, saisonnalit√©, disponibilit√©.\n    * **Suggestion intelligente** : Si un produit est pr√©sent√©, propose un produit compl√©mentaire. Ex : *\"Avec nos tomates, notre basilic frais sera parfait pour une salade estivale !\"*.\n    * Affiche une **image** si disponible.\n    * Relance douce : _\"Souhaitez-vous d√©couvrir d'autres produits ?\"_ ou _\"Si le c≈ìur vous en dit, on peut finaliser votre commande en un clin d‚Äô≈ìil ! \"_.\n\n* **üåø EcoInfo**\n    * Pour pr√©senter jusqu‚Äô√† **3 activit√©s** : Nom, prix, dur√©e ou p√©riode, disponibilit√©.\n    * **Suggestion intelligente** : Si une activit√© est pr√©sent√©e, propose une autre activit√© compl√©mentaire. Ex : *\"Apr√®s la balade en pirogue, pourquoi ne pas prolonger le plaisir avec une d√©gustation fermi√®re ?\"*.\n    * Affiche une **image** si disponible.\n    * Relance douce : _\"Souhaitez-vous explorer d'autres activit√©s ?\"_ ou _\"Souhaitez-vous r√©server celle-ci ?\"_.\n\n* **üë®‚Äçüåæ FermeInfo**\n    * Pour consulter toutes les informations g√©n√©rales sur la ferme : **histoire, mission, valeurs, horaires d'ouverture, adresse, itin√©raire, contacts**.\n    * Utilise ces informations pour r√©pondre aux questions pratiques ou pour cr√©er un lien √©motionnel.\n\n* **üõí Commande et R√©servation**\n    * Pour g√©rer : **Commandes produits** ou **R√©servations d‚Äôactivit√©s**.\n    * **Avant l‚Äôaction** : demander confirmation.\n    * **Apr√®s l‚Äôaction** : afficher un r√©capitulatif clair. **Sp√©cifie que la commande ou la r√©servation a bien √©t√© enregistr√©e et rassure le client en l'informant qu'un agent le contactera sous peu pour finaliser.**\n\n#### **Champs obligatoires selon `actionType` :**\n* `enregistrement` ‚Üí `modificationDetails = \"N/A\"`, `reason = \"N/A\"`\n* `modification` ‚Üí `modificationDetails` requis, `reason = \"N/A\"`\n* `annulation` ‚Üí `reason` requis, `modificationDetails = \"N/A\"`\n\n---\n\n### **üß† Anticipation intelligente et parcours hybride**\n\nQuand le client √©voque un produit, une activit√© ou une information g√©n√©rale :\n* **Identifie le parcours** (`AgroInfo`, `EcoInfo` ou `FermeInfo`).\n* Pr√©sente une **suggestion concr√®te (max 3 √©l√©ments)** suivie d‚Äôune question.\n\n**Exemple produits** üçÖ :\n* Tomates fra√Æches ‚Äì 500 F le kilo\n* Piments doux ‚Äì 350 F le sachet\n* Jus de gingembre ‚Äì 700 F la bouteille\n    > _üîç Vous cherchez un produit en particulier ?_\n\n**Exemple activit√©s** üõ∂ :\n* Balade en pirogue ‚Äì 1 500 F/pers\n* Visite de la ferme ‚Äì 1 000 F\n* D√©gustation fermi√®re ‚Äì 2 500 F\n    > _üåø L‚Äôune vous int√©resse ? Souhaitez-vous r√©server ?_\n\n---\n\n### **‚ö†Ô∏è R√®gles d‚Äôor**\n\n* **Obligation absolue** : toute donn√©e produit/service doit venir **exclusivement** des outils.\n* **Z√©ro invention, z√©ro m√©moire.**\n* Si l‚Äôinformation est absente :\n    > _Cette information n‚Äôest pas encore disponible. Je peux toutefois vous proposer une alternative._\n* Si la demande est hors du p√©rim√®tre :\n    > _Je suis d√©sol√©, je ne peux pas vous renseigner sur ce sujet. Par contre, je peux vous parler de nos produits de saison ou de nos activit√©s d'√©cotourisme !_\n* **Ne jamais mentionner que tu es une IA.**\n* Tu es un **conseiller de la Ferme TOUNRE**.\n* Reste toujours **utile, cr√©dible, bienveillant**.\n\n---\n\n### **üí° UX & D√©tails**\n\n* Utilise les emojis th√©matiques : üçÖ (produits), üõ∂ (activit√©s), üë®‚Äçüåæ (ferme), ‚úÖ (confirmation), üì¶ (commande), üìÖ (r√©servation).\n* Personnalise la salutation si le pr√©nom est connu.\n* Simule un **indicateur de frappe** pour plus de fluidit√©.\n\n---",
          "passthroughBinaryImages": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        304,
        -64
      ],
      "id": "b0cbd378-102b-44fc-9cda-ebc0f1983d63",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        32,
        176
      ],
      "id": "51c4ec95-ceb2-4596-ad70-0045c014e195",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "GcskRhAK7yAtkE01",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=üåø Base de donn√©es officielle des activit√©s √©cotouristiques propos√©es par la Ferme TOUNRE.\n\nüéØ R√¥le de l‚Äôoutil :\nL‚Äôagent IA y acc√®de pour :\n- Identifier et afficher **jusqu‚Äô√† 3 activit√©s adapt√©es** √† l‚Äôintention ou √† la question de l‚Äôutilisateur.\n- Pr√©senter : **nom**, **prix**, **description**, **disponibilit√©**, **places restantes**, **image** (si disponible).\n- Proposer une suite naturelle : exploration ou r√©servation.\n\nüìò Utilisation exclusive pour toute r√©ponse sur les activit√©s :\n- L‚Äôagent n‚Äôest autoris√© √† pr√©senter que ce qui figure ici.\n- Ne jamais inventer de contenu, de prix, ni faire de promesse non v√©rifi√©e.\n\nüí° Astuce : L‚Äôagent peut d√©tecter les intentions (balade, nature, d√©couverte) et basculer automatiquement vers ce module pour engager la discussion √©cotouristique.\n",
        "documentId": {
          "__rl": true,
          "value": "1FCEQlwDllhJW-y_y75I3CwJ_qDSjY6SzSFSxcI26aAg",
          "mode": "list",
          "cachedResultName": "Tounr√©_Base_Compl√®te",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FCEQlwDllhJW-y_y75I3CwJ_qDSjY6SzSFSxcI26aAg/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1631233442,
          "mode": "list",
          "cachedResultName": "Service_Ecotourisme",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FCEQlwDllhJW-y_y75I3CwJ_qDSjY6SzSFSxcI26aAg/edit#gid=1631233442"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.6,
      "position": [
        464,
        176
      ],
      "id": "e2fabb91-11ef-40f0-8261-c38ddfd88f60",
      "name": "EcoInfo",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1n1mMqihE6XowNiW",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=üì¶ Base de donn√©es des produits agroalimentaires disponibles dans la ferme TOUNRE.\n\nüéØ R√¥le de l‚Äôoutil :\nPermet √† l‚Äôagent IA de :\n- Filtrer et pr√©senter **jusqu‚Äô√† 3 produits pertinents √† la fois** selon la demande ou l‚Äôintention utilisateur.\n- Afficher : **nom du produit**, **description**, **prix**, **cat√©gorie**, **stock/disponibilit√© saisonni√®re**, et **image** si disponible.\n- D√©clencher une action douce : d√©couverte de plus de produits ou commande.\n\nüìò Utilisation obligatoire pour toute r√©ponse li√©e aux produits :\n- Z√©ro invention. Z√©ro approximation.\n- Aucune r√©ponse sur les prix, les produits ou les disponibilit√©s ne doit √™tre formul√©e sans consultation directe de cet outil.\n\nüí° Astuce : L‚Äôagent peut proposer des produits similaires ou compl√©mentaires pour favoriser l‚Äôengagement et anticiper les besoins.\n",
        "documentId": {
          "__rl": true,
          "value": "1FCEQlwDllhJW-y_y75I3CwJ_qDSjY6SzSFSxcI26aAg",
          "mode": "list",
          "cachedResultName": "Tounr√©_Base_Compl√®te",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FCEQlwDllhJW-y_y75I3CwJ_qDSjY6SzSFSxcI26aAg/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1374023235,
          "mode": "list",
          "cachedResultName": "Produits_Agricoles",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FCEQlwDllhJW-y_y75I3CwJ_qDSjY6SzSFSxcI26aAg/edit#gid=1374023235"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.6,
      "position": [
        320,
        176
      ],
      "id": "ede786e2-3ecc-470e-a992-4e75ee92e268",
      "name": "AgroInfo",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1n1mMqihE6XowNiW",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=üóÇÔ∏è Outil centralis√© pour **enregistrer, modifier ou annuler** :\n- Une **commande de produit** (depuis AgroInfo).\n- Une **r√©servation d‚Äôactivit√©** (depuis EcoInfo).\n\nüéØ R√¥le de l‚Äôoutil :\nL‚Äôagent IA s‚Äôen sert pour :\n- Confirmer une action avec l‚Äôutilisateur (jamais sans son accord explicite).\n- G√©n√©rer un **r√©capitulatif complet et lisible** apr√®s chaque traitement.\n- Compl√©ter tous les champs requis : `pr√©nom`, `t√©l√©phone`, `typeAction`, `produit/activit√©`, `quantit√©/participants`, `date souhait√©e`, etc.\n- Informer que **le traitement final sera effectu√© par un agent humain**.\n\nüìò Donn√©es enregistr√©es dans un fichier structur√© avec en-t√™te conforme.\n\n‚ö†Ô∏è R√®gles d'or :\n- Aucune action ne doit √™tre ex√©cut√©e si des informations sont manquantes ou floues.\n- Ne jamais annoncer un enregistrement sans l‚Äôavoir valid√© avec l‚Äôutilisateur.\n- Utilisation interdite pour r√©pondre √† des questions g√©n√©rales ou inventer des sc√©narios.\n\nüí° Astuce : L‚Äôagent peut proposer l‚Äôenregistrement comme une suite logique √† une interaction r√©ussie (‚ÄúSouhaitez-vous que je r√©serve cela pour vous ?‚Äù).\n",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1FCEQlwDllhJW-y_y75I3CwJ_qDSjY6SzSFSxcI26aAg",
          "mode": "list",
          "cachedResultName": "Tounr√©_Base_Compl√®te",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FCEQlwDllhJW-y_y75I3CwJ_qDSjY6SzSFSxcI26aAg/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 780894042,
          "mode": "list",
          "cachedResultName": "Commande_et_Reservation",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FCEQlwDllhJW-y_y75I3CwJ_qDSjY6SzSFSxcI26aAg/edit#gid=780894042"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "t√©l√©phone": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('t_l_phone', ``, 'string') }}",
            "pr√©nom": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('pr_nom', ``, 'string') }}",
            "typeAction": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('typeAction', ``, 'string') }}",
            "produitOuActivit√©": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('produitOuActivit_', ``, 'string') }}",
            "quantit√©OuParticipants": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('quantit_OuParticipants', ``, 'string') }}",
            "modificationDetails": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('modificationDetails', ``, 'string') }}",
            "reason": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('reason', ``, 'string') }}",
            "statutTraitement": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('statutTraitement', ``, 'string') }}",
            "agentResponsable": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('agentResponsable', ``, 'string') }}",
            "Date": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Date', ``, 'string') }}",
            "DateSouhait√©e": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('DateSouhait_e', ``, 'string') }}"
          },
          "matchingColumns": [
            "Date"
          ],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pr√©nom",
              "displayName": "pr√©nom",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "t√©l√©phone",
              "displayName": "t√©l√©phone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "typeAction",
              "displayName": "typeAction",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "produitOuActivit√©",
              "displayName": "produitOuActivit√©",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "quantit√©OuParticipants",
              "displayName": "quantit√©OuParticipants",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "DateSouhait√©e",
              "displayName": "DateSouhait√©e",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "modificationDetails",
              "displayName": "modificationDetails",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "reason",
              "displayName": "reason",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "statutTraitement",
              "displayName": "statutTraitement",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "agentResponsable",
              "displayName": "agentResponsable",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "cellFormat": "RAW"
        }
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.6,
      "position": [
        752,
        176
      ],
      "id": "ba9549ec-e3d0-4424-b817-89f86f4d8fb5",
      "name": "Commande_et_Reservation",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1n1mMqihE6XowNiW",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1FCEQlwDllhJW-y_y75I3CwJ_qDSjY6SzSFSxcI26aAg",
          "mode": "list",
          "cachedResultName": "Tounr√©_Base_Compl√®te",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FCEQlwDllhJW-y_y75I3CwJ_qDSjY6SzSFSxcI26aAg/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 636510974,
          "mode": "list",
          "cachedResultName": "FermeInfo",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FCEQlwDllhJW-y_y75I3CwJ_qDSjY6SzSFSxcI26aAg/edit#gid=636510974"
        },
        "combineFilters": "OR",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.6,
      "position": [
        608,
        176
      ],
      "id": "030c99e0-6225-45e9-afb2-09d2686311de",
      "name": "FermeInfo",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1n1mMqihE6XowNiW",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Webhook').item.json.body.session_id }}",
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        192,
        176
      ],
      "id": "eb4f2e0a-bc16-4aa5-b71d-6f861f0b320b",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        640,
        -64
      ],
      "id": "ec12c37c-19f6-4a90-bb75-fed69328f510",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "Tounre",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -32,
        -64
      ],
      "id": "c7509ca8-6c9b-4232-a507-9b46fa6b09f2",
      "name": "Webhook",
      "webhookId": "f10e3ed0-d202-4d8d-b6e1-0abf829d0a87"
    }
  ],
  "pinData": {},
  "repo_name": "n8n-back-up",
  "repo_owner": "BotBj",
  "repo_path": "myn8n/",
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-08-16T16:27:14.452Z",
      "updatedAt": "2025-08-16T16:27:14.452Z",
      "role": "workflow:owner",
      "workflowId": "0tNHs5w0w0wqhj8h",
      "projectId": "rtwT9HNaRzX30hVn"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-08-19T14:05:08.000Z",
  "versionId": "8f57b73a-7f2e-4e9a-acf0-fd59399476c4"
}